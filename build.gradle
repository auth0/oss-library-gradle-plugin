plugins {
    id 'maven-publish'
    id 'java-gradle-plugin'
    id 'groovy'
    id "com.gradle.plugin-publish" version "0.12.0"
}

repositories {
    google()
    mavenCentral()
    gradlePluginPortal()
}

tasks.wrapper {
    distributionType 'all'
}

dependencies {
    implementation "me.champeau.gradle:japicmp-gradle-plugin:0.2.9"
    // needed because of https://github.com/melix/japicmp-gradle-plugin/issues/36
    implementation 'com.google.guava:guava:30.0-jre'
    testImplementation("org.spockframework:spock-core:2.0-M2-groovy-3.0") {
        exclude module: 'groovy-all'
        exclude module: 'groovy-nio'
        exclude module: 'groovy-sql'
        exclude module: 'groovy-xml'
    }
    testImplementation "org.hamcrest:hamcrest-core:1.3"
    testImplementation "com.android.tools.build:gradle:3.6.1"
}

compileJava {
    sourceCompatibility JavaVersion.VERSION_1_8.toString()
    targetCompatibility JavaVersion.VERSION_1_8.toString()
}

compileGroovy {
    sourceCompatibility JavaVersion.VERSION_1_8.toString()
    targetCompatibility JavaVersion.VERSION_1_8.toString()
}

tasks.withType(Test).configureEach {
    maxParallelForks = Runtime.getRuntime().availableProcessors()

    testLogging {
        events 'passed', 'failed', 'skipped'
        showStandardStreams = true
        exceptionFormat 'full'
    }
}

version = "0.19.0"
group = "com.auth0.gradle"

gradlePlugin {
    plugins {
        javaLibraryPlugin {
            id = 'com.auth0.gradle.oss-library.java'
            implementationClass = 'com.auth0.gradle.oss.LibraryPlugin'
        }
        androidLibraryPlugin {
            id = 'com.auth0.gradle.oss-library.android'
            implementationClass = 'com.auth0.gradle.oss.AndroidLibraryPlugin'
        }
    }
}

// The configuration example below shows the minimum required properties
// configured to publish your plugin to the plugin portal
pluginBundle {
    website = 'https://github.com/auth0/oss-library-gradle-plugin'
    vcsUrl = 'https://github.com/auth0/oss-library-gradle-plugin'
    description = 'Gradle plugin to configure a Java/Android oss library'
    tags = ['auth0', 'oss', 'java', 'build', 'android', 'publish']

    plugins {
        javaLibraryPlugin {
            id = 'com.auth0.gradle.oss-library.java'
            displayName = 'Auth0 OSS library plugin for Java libs'
        }
        androidLibraryPlugin {
            id = 'com.auth0.gradle.oss-library.android'
            displayName = 'Auth0 OSS library plugin for Android Java libs'
        }
    }
}
